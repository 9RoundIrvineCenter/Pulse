<!DOCTYPE html>
<html>
<head>
  <title>9Round Irvine Center Pulse & CHOW Challenge</title>
  <link rel="stylesheet" type="text/css" href="styles.css"> <!-- Make sure this path is correct -->
</head>
<body>
  <!-- Embed the iframes with the Google Sheet -->
  <iframe id="sheetFrame" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRQ2ZHMxBUYYGkZ2z59Kqd94GumA60KdJ4WkzE3ysHfNgmpyrI5vyGM633foL3cJr_YNOUFJ-bPU_Kd/pubhtml?gid=748229350&single=true&widget=false&headers=false&chrome=false" frameborder="0"></iframe>
  <iframe id="sheetFrame2" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRQ2ZHMxBUYYGkZ2z59Kqd94GumA60KdJ4WkzE3ysHfNgmpyrI5vyGM633foL3cJr_YNOUFJ-bPU_Kd/pubhtml?gid=748229350&single=true&widget=false&headers=false&chrome=false" frameborder="0"></iframe>
  <div id="loadingOverlay">
    <img src="/images/logo-white-9r.png" id="loadingLogo" alt="Loading Logo">
  </div>
  </div>
  <div id="top-bar"></div>  <!-- Added for demonstration, adjust as needed -->

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    setBlackBackground();
    
    let currentFrame = 'sheetFrame';
    let nextFrame = 'sheetFrame2';

    // Function to check if it's within refresh time
    function shouldRefresh() {
      const now = new Date();
      const day = now.getDay();
      const hour = now.getHours();

      if (day >= 1 && day <= 5) { // Weekdays
        return hour >= 7 && hour < 21;
      } else { // Weekend
        return hour >= 8 && hour < 18;
      }
    }

    // Function to perform soft refresh using double buffering
    function softRefresh() {
      if (shouldRefresh()) {
        const loadingOverlay = document.getElementById('loadingOverlay');
        loadingOverlay.classList.add('displayed'); // This will make it visible with transition
        loadingOverlay.style.pointerEvents = 'auto'; // Enable interaction
    
        const current = document.getElementById(currentFrame);
        const next = document.getElementById(nextFrame);
    
        // Preserve existing URL parameters while adding cache busting
        const url = new URL(next.src);
        url.searchParams.set('t', new Date().getTime()); // Cache busting
        next.src = url.href;
    
        next.style.display = 'block';
        next.style.animation = 'fadeIn 0.5s';
        current.style.animation = 'fadeOut 0.5s';
    
        next.onload = () => {
          // Wait for the transition to finish before hiding the overlay
          setTimeout(() => {
            loadingOverlay.classList.remove('displayed'); // This will hide it with transition
            loadingOverlay.style.pointerEvents = 'none'; // Disable interaction
            current.style.display = 'none';
            // Swap frame identifiers for next refresh
            let temp = currentFrame;
            currentFrame = nextFrame;
            nextFrame = temp;
          }, 500); // Match with the transition duration
        };
      }
    }

    // Set interval for soft refresh
    setInterval(softRefresh, 30000); // 30000 milliseconds = 30 seconds

    // Function to set background color
    function setBlackBackground() {
      document.body.style.backgroundColor = 'black';
      document.documentElement.style.backgroundColor = 'black';
    }
  });
  </script>

</body>
</html>
